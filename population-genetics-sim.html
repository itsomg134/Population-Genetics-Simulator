<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Population Genetics Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 0.95em;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .control-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 0.9em;
        }

        input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }

        .value-display {
            color: #667eea;
            font-weight: bold;
            font-size: 1.1em;
        }

        .buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 101, 101, 0.4);
        }

        .visualization {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        canvas {
            width: 100%;
            height: 300px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.85em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
        }

        .population-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .individuals {
            display: flex;
            flex-wrap: wrap;
            gap: 3px;
            margin-top: 10px;
        }

        .individual {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .genotype-AA { background: #e53e3e; }
        .genotype-Aa { background: #ed8936; }
        .genotype-aa { background: #48bb78; }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        @media (max-width: 768px) {
            .visualization {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Population Genetics Simulator</h1>
        <p class="subtitle">Explore how allele frequencies change across generations through selection, mutation, and genetic drift</p>

        <div class="controls">
            <div class="control-group">
                <label>Population Size: <span class="value-display" id="popSizeDisplay">1000</span></label>
                <input type="range" id="popSize" min="100" max="5000" step="100" value="1000">
            </div>

            <div class="control-group">
                <label>Initial Allele A Frequency: <span class="value-display" id="alleleFreqDisplay">0.50</span></label>
                <input type="range" id="alleleFreq" min="0" max="1" step="0.01" value="0.5">
            </div>

            <div class="control-group">
                <label>Selection Coefficient (s): <span class="value-display" id="selectionDisplay">0.00</span></label>
                <input type="range" id="selection" min="-0.5" max="0.5" step="0.01" value="0">
                <small style="color: #666;">Positive favors AA, negative favors aa</small>
            </div>

            <div class="control-group">
                <label>Mutation Rate: <span class="value-display" id="mutationDisplay">0.001</span></label>
                <input type="range" id="mutation" min="0" max="0.01" step="0.0001" value="0.001">
            </div>

            <div class="control-group">
                <label>Generations per Step: <span class="value-display" id="genStepDisplay">1</span></label>
                <input type="number" id="genStep" min="1" max="100" value="1">
            </div>
        </div>

        <div class="buttons">
            <button class="btn-primary" onclick="simulateGeneration()">Next Generation</button>
            <button class="btn-secondary" onclick="autoSimulate()">Auto Run (10 Gen)</button>
            <button class="btn-danger" onclick="resetSimulation()">Reset</button>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-label">Generation</div>
                <div class="stat-value" id="genCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Allele A Frequency</div>
                <div class="stat-value" id="freqA">0.500</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Allele a Frequency</div>
                <div class="stat-value" id="freqa">0.500</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Heterozygosity</div>
                <div class="stat-value" id="hetero">0.500</div>
            </div>
        </div>

        <div class="visualization">
            <div class="chart-container">
                <h3>Allele Frequency Over Time</h3>
                <canvas id="freqChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Genotype Distribution</h3>
                <canvas id="genotypeChart"></canvas>
            </div>
        </div>

        <div class="population-display">
            <h3>Current Population (Sample of 1000 individuals)</h3>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color genotype-AA"></div>
                    <span>AA (Homozygous Dominant)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color genotype-Aa"></div>
                    <span>Aa (Heterozygous)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color genotype-aa"></div>
                    <span>aa (Homozygous Recessive)</span>
                </div>
            </div>
            <div class="individuals" id="populationViz"></div>
        </div>
    </div>

    <script>
        let population = [];
        let generation = 0;
        let freqHistory = [];
        let genotypeHistory = [];

        const freqCtx = document.getElementById('freqChart').getContext('2d');
        const genotypeCtx = document.getElementById('genotypeChart').getContext('2d');

        function initializePopulation() {
            const size = parseInt(document.getElementById('popSize').value);
            const freqA = parseFloat(document.getElementById('alleleFreq').value);
            
            population = [];
            for (let i = 0; i < size; i++) {
                const allele1 = Math.random() < freqA ? 'A' : 'a';
                const allele2 = Math.random() < freqA ? 'A' : 'a';
                population.push([allele1, allele2]);
            }
            
            generation = 0;
            freqHistory = [];
            genotypeHistory = [];
            
            updateDisplay();
        }

        function calculateFrequencies() {
            let countA = 0;
            let totalAlleles = population.length * 2;
            
            population.forEach(individual => {
                if (individual[0] === 'A') countA++;
                if (individual[1] === 'A') countA++;
            });
            
            return countA / totalAlleles;
        }

        function getGenotypeCounts() {
            let AA = 0, Aa = 0, aa = 0;
            
            population.forEach(individual => {
                const genotype = individual.sort().join('');
                if (genotype === 'AA') AA++;
                else if (genotype === 'Aa') Aa++;
                else aa++;
            });
            
            return { AA, Aa, aa };
        }

        function getFitness(individual, selectionCoeff) {
            const genotype = individual.sort().join('');
            if (genotype === 'AA') return 1 + selectionCoeff;
            if (genotype === 'Aa') return 1 + selectionCoeff / 2;
            return 1;
        }

        function simulateGeneration() {
            const steps = parseInt(document.getElementById('genStep').value);
            
            for (let step = 0; step < steps; step++) {
                const selectionCoeff = parseFloat(document.getElementById('selection').value);
                const mutationRate = parseFloat(document.getElementById('mutation').value);
                
                const fitnesses = population.map(ind => getFitness(ind, selectionCoeff));
                const totalFitness = fitnesses.reduce((a, b) => a + b, 0);
                
                const newPopulation = [];
                
                for (let i = 0; i < population.length; i++) {
                    let r1 = Math.random() * totalFitness;
                    let r2 = Math.random() * totalFitness;
                    let parent1, parent2;
                    let cumFitness = 0;
                    
                    for (let j = 0; j < population.length; j++) {
                        cumFitness += fitnesses[j];
                        if (!parent1 && cumFitness >= r1) parent1 = population[j];
                        if (!parent2 && cumFitness >= r2) parent2 = population[j];
                        if (parent1 && parent2) break;
                    }
                    
                    let allele1 = parent1[Math.random() < 0.5 ? 0 : 1];
                    let allele2 = parent2[Math.random() < 0.5 ? 0 : 1];
                    
                    if (Math.random() < mutationRate) {
                        allele1 = allele1 === 'A' ? 'a' : 'A';
                    }
                    if (Math.random() < mutationRate) {
                        allele2 = allele2 === 'A' ? 'a' : 'A';
                    }
                    
                    newPopulation.push([allele1, allele2]);
                }
                
                population = newPopulation;
                generation++;
            }
            
            updateDisplay();
        }

        function autoSimulate() {
            let count = 0;
            const interval = setInterval(() => {
                simulateGeneration();
                count++;
                if (count >= 10) clearInterval(interval);
            }, 100);
        }

        function updateDisplay() {
            const freqA = calculateFrequencies();
            const freqa = 1 - freqA;
            const counts = getGenotypeCounts();
            const hetero = counts.Aa / population.length;
            
            document.getElementById('genCount').textContent = generation;
            document.getElementById('freqA').textContent = freqA.toFixed(3);
            document.getElementById('freqa').textContent = freqa.toFixed(3);
            document.getElementById('hetero').textContent = hetero.toFixed(3);
            
            freqHistory.push({ gen: generation, freqA, freqa });
            genotypeHistory.push({ gen: generation, ...counts });
            
            drawFrequencyChart();
            drawGenotypeChart();
            drawPopulation();
        }

        function drawFrequencyChart() {
            freqCtx.clearRect(0, 0, freqCtx.canvas.width, freqCtx.canvas.height);
            
            if (freqHistory.length < 2) return;
            
            const width = freqCtx.canvas.width;
            const height = freqCtx.canvas.height;
            const padding = 40;
            
            const maxGen = freqHistory[freqHistory.length - 1].gen;
            const xScale = (width - 2 * padding) / Math.max(maxGen, 1);
            const yScale = height - 2 * padding;
            
            freqCtx.strokeStyle = '#e53e3e';
            freqCtx.lineWidth = 2;
            freqCtx.beginPath();
            freqHistory.forEach((point, i) => {
                const x = padding + point.gen * xScale;
                const y = height - padding - point.freqA * yScale;
                if (i === 0) freqCtx.moveTo(x, y);
                else freqCtx.lineTo(x, y);
            });
            freqCtx.stroke();
            
            freqCtx.strokeStyle = '#48bb78';
            freqCtx.beginPath();
            freqHistory.forEach((point, i) => {
                const x = padding + point.gen * xScale;
                const y = height - padding - point.freqa * yScale;
                if (i === 0) freqCtx.moveTo(x, y);
                else freqCtx.lineTo(x, y);
            });
            freqCtx.stroke();
            
            freqCtx.strokeStyle = '#ddd';
            freqCtx.lineWidth = 1;
            freqCtx.beginPath();
            freqCtx.moveTo(padding, padding);
            freqCtx.lineTo(padding, height - padding);
            freqCtx.lineTo(width - padding, height - padding);
            freqCtx.stroke();
            
            freqCtx.fillStyle = '#333';
            freqCtx.font = '12px sans-serif';
            freqCtx.fillText('1.0', 5, padding);
            freqCtx.fillText('0.5', 5, padding + yScale / 2);
            freqCtx.fillText('0.0', 5, height - padding);
            freqCtx.fillText('Generation', width / 2 - 30, height - 10);
        }

        function drawGenotypeChart() {
            genotypeCtx.clearRect(0, 0, genotypeCtx.canvas.width, genotypeCtx.canvas.height);
            
            if (genotypeHistory.length === 0) return;
            
            const current = genotypeHistory[genotypeHistory.length - 1];
            const total = current.AA + current.Aa + current.aa;
            
            const width = genotypeCtx.canvas.width;
            const height = genotypeCtx.canvas.height;
            const barWidth = width / 4;
            const maxHeight = height - 60;
            
            const data = [
                { label: 'AA', count: current.AA, color: '#e53e3e' },
                { label: 'Aa', count: current.Aa, color: '#ed8936' },
                { label: 'aa', count: current.aa, color: '#48bb78' }
            ];
            
            data.forEach((item, i) => {
                const barHeight = (item.count / total) * maxHeight;
                const x = barWidth * (i + 0.5);
                const y = height - barHeight - 40;
                
                genotypeCtx.fillStyle = item.color;
                genotypeCtx.fillRect(x - barWidth / 3, y, barWidth * 2 / 3, barHeight);
                
                genotypeCtx.fillStyle = '#333';
                genotypeCtx.font = 'bold 14px sans-serif';
                genotypeCtx.textAlign = 'center';
                genotypeCtx.fillText(item.label, x, height - 20);
                
                const pct = ((item.count / total) * 100).toFixed(1);
                genotypeCtx.fillText(pct + '%', x, y - 10);
            });
        }

        function drawPopulation() {
            const container = document.getElementById('populationViz');
            container.innerHTML = '';
            
            const sample = population.slice(0, 1000);
            
            sample.forEach(individual => {
                const div = document.createElement('div');
                div.className = 'individual';
                const genotype = individual.sort().join('');
                div.classList.add('genotype-' + genotype);
                container.appendChild(div);
            });
        }

        function resetSimulation() {
            initializePopulation();
        }

        document.getElementById('popSize').addEventListener('input', (e) => {
            document.getElementById('popSizeDisplay').textContent = e.target.value;
        });

        document.getElementById('alleleFreq').addEventListener('input', (e) => {
            document.getElementById('alleleFreqDisplay').textContent = parseFloat(e.target.value).toFixed(2);
        });

        document.getElementById('selection').addEventListener('input', (e) => {
            document.getElementById('selectionDisplay').textContent = parseFloat(e.target.value).toFixed(2);
        });

        document.getElementById('mutation').addEventListener('input', (e) => {
            document.getElementById('mutationDisplay').textContent = parseFloat(e.target.value).toFixed(4);
        });

        document.getElementById('genStep').addEventListener('input', (e) => {
            document.getElementById('genStepDisplay').textContent = e.target.value;
        });

        initializePopulation();
    </script>
</body>
</html>